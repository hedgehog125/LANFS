import{S as B,i as F,s as S,e as k,c as b,a as y,d as m,b as N,g as p,J as I,n as g,t as E,h as C,l as T,k as U,m as P,L as O,j as H,R as K,T as Q,M as L,N as X,U as Y,x as z,y as R,z as A,p as v,q as Z,r as $,C as j,w as x,o as ee}from"../chunks/index-4db9d871.js";import{T as te}from"../chunks/TopBar-edd7016d.js";function oe(a){let e;return{c(){e=E("Connecting...")},l(t){e=C(t,"Connecting...")},m(t,n){p(t,e,n)},d(t){t&&m(e)}}}function le(a){let e,t,n;return{c(){e=E("Connection error. "),t=k("br"),n=E(`\r
				Will continue to retry...`)},l(o){e=C(o,"Connection error. "),t=b(o,"BR",{}),n=C(o,`\r
				Will continue to retry...`)},m(o,l){p(o,e,l),p(o,t,l),p(o,n,l)},d(o){o&&m(e),o&&m(t),o&&m(n)}}}function ne(a){let e,t,n;function o(i,s){return i[0]?le:oe}let l=o(a),r=l(a);return{c(){e=k("main"),t=k("div"),n=k("p"),r.c(),this.h()},l(i){e=b(i,"MAIN",{});var s=y(e);t=b(s,"DIV",{class:!0});var _=y(t);n=b(_,"P",{class:!0});var f=y(n);r.l(f),f.forEach(m),_.forEach(m),s.forEach(m),this.h()},h(){N(n,"class","svelte-ma1ccf"),N(t,"class","svelte-ma1ccf")},m(i,s){p(i,e,s),I(e,t),I(t,n),r.m(n,null)},p(i,[s]){l!==(l=o(i))&&(r.d(1),r=l(i),r&&(r.c(),r.m(n,null)))},i:g,o:g,d(i){i&&m(e),r.d()}}}function re(a,e,t){let{isNetworkError:n}=e;return a.$$set=o=>{"isNetworkError"in o&&t(0,n=o.isNetworkError)},[n]}class ie extends B{constructor(e){super(),F(this,e,re,ne,S,{isNetworkError:0})}}function W(a,e,t){const n=a.slice();return n[4]=e[t],n[6]=t,n}function J(a){let e,t=a[4].fileName+"",n,o,l,r,i,s,_,f;function d(...c){return a[3](a[4],...c)}let u=!a[4].ready&&V(a);return{c(){e=k("a"),n=E(t),r=U(),u&&u.c(),i=U(),s=k("br"),this.h()},l(c){e=b(c,"A",{href:!0,download:!0});var h=y(e);n=C(h,t),h.forEach(m),r=P(c),u&&u.l(c),i=P(c),s=b(c,"BR",{}),this.h()},h(){N(e,"href",o=`/room/get/${a[0]}/${a[6]}`),N(e,"download",l=a[4].fileName)},m(c,h){p(c,e,h),I(e,n),p(c,r,h),u&&u.m(c,h),p(c,i,h),p(c,s,h),_||(f=O(e,"click",d),_=!0)},p(c,h){a=c,h&2&&t!==(t=a[4].fileName+"")&&H(n,t),h&3&&o!==(o=`/room/get/${a[0]}/${a[6]}`)&&N(e,"href",o),h&2&&l!==(l=a[4].fileName)&&N(e,"download",l),a[4].ready?u&&(u.d(1),u=null):u?u.p(a,h):(u=V(a),u.c(),u.m(i.parentNode,i))},d(c){c&&m(e),c&&m(r),u&&u.d(c),c&&m(i),c&&m(s),_=!1,f()}}}function V(a){let e=Math.floor(a[4].uploadProgress*100)+"",t,n;return{c(){t=E(e),n=E("%")},l(o){t=C(o,e),n=C(o,"%")},m(o,l){p(o,t,l),p(o,n,l)},p(o,l){l&2&&e!==(e=Math.floor(o[4].uploadProgress*100)+"")&&H(t,e)},d(o){o&&m(t),o&&m(n)}}}function G(a,e){let t,n,o=e[4]!=null&&J(e);return{key:a,first:null,c(){t=T(),o&&o.c(),n=T(),this.h()},l(l){t=T(),o&&o.l(l),n=T(),this.h()},h(){this.first=t},m(l,r){p(l,t,r),o&&o.m(l,r),p(l,n,r)},p(l,r){e=l,e[4]!=null?o?o.p(e,r):(o=J(e),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},d(l){l&&m(t),o&&o.d(l),l&&m(n)}}}function ae(a){let e,t=[],n=new Map,o=a[1].files;const l=r=>r[6];for(let r=0;r<o.length;r+=1){let i=W(a,o,r),s=l(i);n.set(s,t[r]=G(s,i))}return{c(){e=k("main");for(let r=0;r<t.length;r+=1)t[r].c()},l(r){e=b(r,"MAIN",{});var i=y(e);for(let s=0;s<t.length;s+=1)t[s].l(i);i.forEach(m)},m(r,i){p(r,e,i);for(let s=0;s<t.length;s+=1)t[s].m(e,null)},p(r,[i]){i&7&&(o=r[1].files,t=K(t,i,l,1,r,o,n,e,Q,G,null,W))},i:g,o:g,d(r){r&&m(e);for(let i=0;i<t.length;i+=1)t[i].d()}}}function se(a,e,t){let{roomName:n}=e,{roomData:o}=e;const l=(i,s)=>{s.ready||i.preventDefault()},r=(i,s)=>l(s,i);return a.$$set=i=>{"roomName"in i&&t(0,n=i.roomName),"roomData"in i&&t(1,o=i.roomData)},[n,o,l,r]}class fe extends B{constructor(e){super(),F(this,e,se,ae,S,{roomName:0,roomData:1})}}function ce(a){let e,t;return{c:g,l:g,m(n,o){e||(t=[O(window,"dragover",L(a[2])),O(window,"drop",L(a[0]))],e=!0)},p:g,i:g,o:g,d(n){e=!1,X(t)}}}function ue(a,e,t){let{onUpload:n}=e;const o=r=>{let i=r.dataTransfer.items;if(i){let s=[];for(let _ of i)_.kind=="file"&&s.push(_.getAsFile());s.length!=0&&n(s)}};function l(r){Y.call(this,a,r)}return a.$$set=r=>{"onUpload"in r&&t(1,n=r.onUpload)},[o,n,l]}class me extends B{constructor(e){super(),F(this,e,ue,ce,S,{onUpload:1})}}function _e(a){let e,t,n,o;return e=new fe({props:{roomName:a[1],roomData:a[0]}}),n=new me({props:{onUpload:a[4]}}),{c(){z(e.$$.fragment),t=U(),z(n.$$.fragment)},l(l){R(e.$$.fragment,l),t=P(l),R(n.$$.fragment,l)},m(l,r){A(e,l,r),p(l,t,r),A(n,l,r),o=!0},p(l,r){const i={};r&2&&(i.roomName=l[1]),r&1&&(i.roomData=l[0]),e.$set(i)},i(l){o||($(e.$$.fragment,l),$(n.$$.fragment,l),o=!0)},o(l){v(e.$$.fragment,l),v(n.$$.fragment,l),o=!1},d(l){j(e,l),l&&m(t),j(n,l)}}}function pe(a){let e,t;return e=new ie({props:{isNetworkError:a[3]}}),{c(){z(e.$$.fragment)},l(n){R(e.$$.fragment,n)},m(n,o){A(e,n,o),t=!0},p(n,o){const l={};o&8&&(l.isNetworkError=n[3]),e.$set(l)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){v(e.$$.fragment,n),t=!1},d(n){j(e,n)}}}function de(a){let e,t,n,o,l,r;t=new te({});const i=[pe,_e],s=[];function _(f,d){return f[2]?0:1}return o=_(a),l=s[o]=i[o](a),{c(){e=k("main"),z(t.$$.fragment),n=U(),l.c()},l(f){e=b(f,"MAIN",{});var d=y(e);R(t.$$.fragment,d),n=P(d),l.l(d),d.forEach(m)},m(f,d){p(f,e,d),A(t,e,null),I(e,n),s[o].m(e,null),r=!0},p(f,[d]){let u=o;o=_(f),o===u?s[o].p(f,d):(ee(),v(s[u],1,1,()=>{s[u]=null}),Z(),l=s[o],l?l.p(f,d):(l=s[o]=i[o](f),l.c()),$(l,1),l.m(e,null))},i(f){r||($(t.$$.fragment,f),$(l),r=!0)},o(f){v(t.$$.fragment,f),v(l),r=!1},d(f){f&&m(e),j(t),s[o].d()}}}function he(a,e,t){let o,l,r,i,s=!0,_,f=!1;const d=async D=>{let w;try{w=await fetch(`/room/get/${i}`),w.ok?t(0,r=await w.json()):(t(0,r=null),t(3,f=!1))}catch{t(0,r=null),t(3,f=!0)}r?_=setTimeout(M=>{t(2,s=!1)},750):(t(2,s=!0),_!=null&&clearTimeout(_))},u=async D=>{l=await(await fetch("/info")).json(),o=l.clientConfig},c=D=>{location.href="/"},h=D=>{let w=!1;for(let M of D){if(M.size>o.max.fileSize){w=!0;continue}let q=new FormData;q.set("upload",M),fetch(`room/upload/${i}`,{method:"POST",body:q}),t(0,r.files[r.files.length]={fileName:M.name,timeLeft:0,ready:!1,uploadProgress:0,size:M.size},r)}if(w)debugger};return x(async D=>{if(t(1,i=location.hash.slice(1)),i==""){c();return}d(),await u(),setInterval(d,o.timings.refreshDelay*1e3)}),[r,i,s,f,h]}class be extends B{constructor(e){super(),F(this,e,he,de,S,{})}}export{be as default};
