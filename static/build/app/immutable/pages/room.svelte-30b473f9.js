import{S as Y,i as Z,s as K,e as b,c as v,a as w,d as c,b as f,g as k,J as h,n as j,t as O,k as U,l as C,h as R,m as F,j as ce,P as ee,L as te,T as ze,U as Ue,V as le,W as oe,f as _e,x as W,y as H,X as be,z as J,r as I,p as P,C as X,o as re,q as se,Y as Fe,Z as je,M as ve,N as Be,_ as Le,w as Ae}from"../chunks/index-fd06faab.js";import{T as Se}from"../chunks/TopBar-1a82d815.js";let ie,ae;const Oe=async a=>{ie=await(await fetch("/info")).json(),ae=ie.clientConfig};var Pe="/app/immutable/assets/close-02f49dd1.svg";function ke(a,e,t){const l=a.slice();return l[6]=e[t],l[8]=t,l}function we(a){let e,t;function l(o,r){return o[2]==-1?Ve:Re}let n=l(a),i=n(a);return{c(){e=b("div"),t=b("p"),i.c(),this.h()},l(o){e=v(o,"DIV",{class:!0});var r=w(e);t=v(r,"P",{class:!0});var s=w(t);i.l(s),s.forEach(c),r.forEach(c),this.h()},h(){f(t,"class","svelte-lj1lm6"),f(e,"class","svelte-lj1lm6")},m(o,r){k(o,e,r),h(e,t),i.m(t,null)},p(o,r){n===(n=l(o))&&i?i.p(o,r):(i.d(1),i=n(o),i&&(i.c(),i.m(t,null)))},d(o){o&&c(e),i.d()}}}function Re(a){let e,t,l=a[4],n=[];for(let o=0;o<l.length;o+=1)n[o]=xe(ke(a,l,o));let i=a[2]!=2&&De(a);return{c(){for(let o=0;o<n.length;o+=1)n[o].c();e=U(),i&&i.c(),t=C()},l(o){for(let r=0;r<n.length;r+=1)n[r].l(o);e=F(o),i&&i.l(o),t=C()},m(o,r){for(let s=0;s<n.length;s+=1)n[s].m(o,r);k(o,e,r),i&&i.m(o,r),k(o,t,r)},p(o,r){if(r&16){l=o[4];let s;for(s=0;s<l.length;s+=1){const u=ke(o,l,s);n[s]?n[s].p(u,r):(n[s]=xe(u),n[s].c(),n[s].m(e.parentNode,e))}for(;s<n.length;s+=1)n[s].d(1);n.length=l.length}o[2]!=2?i?i.p(o,r):(i=De(o),i.c(),i.m(t.parentNode,t)):i&&(i.d(1),i=null)},d(o){Ue(n,o),o&&c(e),i&&i.d(o),o&&c(t)}}}function Ve(a){let e,t=a[1]&&Ne(a);return{c(){t&&t.c(),e=C()},l(l){t&&t.l(l),e=C()},m(l,n){t&&t.m(l,n),k(l,e,n)},p(l,n){l[1]?t?t.p(l,n):(t=Ne(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},d(l){t&&t.d(l),l&&c(e)}}}function ye(a){let e;return{c(){e=b("br")},l(t){e=v(t,"BR",{})},m(t,l){k(t,e,l)},d(t){t&&c(e)}}}function xe(a){let e=a[6]+"",t,l,n,i=a[8]!=a[4].length-1&&ye();return{c(){t=O(e),l=U(),i&&i.c(),n=C()},l(o){t=R(o,e),l=F(o),i&&i.l(o),n=C()},m(o,r){k(o,t,r),k(o,l,r),i&&i.m(o,r),k(o,n,r)},p(o,r){r&16&&e!==(e=o[6]+"")&&ce(t,e),o[8]!=o[4].length-1?i||(i=ye(),i.c(),i.m(n.parentNode,n)):i&&(i.d(1),i=null)},d(o){o&&c(t),o&&c(l),i&&i.d(o),o&&c(n)}}}function De(a){let e,t,l,n,i;return{c(){e=b("button"),t=b("img"),this.h()},l(o){e=v(o,"BUTTON",{type:!0,title:!0,class:!0});var r=w(e);t=v(r,"IMG",{src:!0,width:!0,height:!0,alt:!0,class:!0}),r.forEach(c),this.h()},h(){ee(t.src,l=Pe)||f(t,"src",l),f(t,"width","24"),f(t,"height","24"),f(t,"alt","Close"),f(t,"class","svelte-lj1lm6"),f(e,"type","button"),f(e,"title","Close"),f(e,"class","svelte-lj1lm6")},m(o,r){k(o,e,r),h(e,t),n||(i=te(e,"click",function(){ze(a[3])&&a[3].apply(this,arguments)}),n=!0)},p(o,r){a=o},d(o){o&&c(e),n=!1,i()}}}function Ne(a){let e;function t(i,o){return i[0]?Ge:qe}let l=t(a),n=l(a);return{c(){n.c(),e=C()},l(i){n.l(i),e=C()},m(i,o){n.m(i,o),k(i,e,o)},p(i,o){l!==(l=t(i))&&(n.d(1),n=l(i),n&&(n.c(),n.m(e.parentNode,e)))},d(i){n.d(i),i&&c(e)}}}function qe(a){let e;return{c(){e=O("Connecting...")},l(t){e=R(t,"Connecting...")},m(t,l){k(t,e,l)},d(t){t&&c(e)}}}function Ge(a){let e,t,l;return{c(){e=O("Connection error. "),t=b("br"),l=O(`
							Will continue to retry...`)},l(n){e=R(n,"Connection error. "),t=v(n,"BR",{}),l=R(n,`
							Will continue to retry...`)},m(n,i){k(n,e,i),k(n,t,i),k(n,l,i)},d(n){n&&c(e),n&&c(t),n&&c(l)}}}function We(a){let e,t=(a[2]!=-1||a[1])&&we(a);return{c(){e=b("main"),t&&t.c(),this.h()},l(l){e=v(l,"MAIN",{class:!0});var n=w(e);t&&t.l(n),n.forEach(c),this.h()},h(){f(e,"class","svelte-lj1lm6")},m(l,n){k(l,e,n),t&&t.m(e,null)},p(l,[n]){l[2]!=-1||l[1]?t?t.p(l,n):(t=we(l),t.c(),t.m(e,null)):t&&(t.d(1),t=null)},i:j,o:j,d(l){l&&c(e),t&&t.d()}}}function He(a,e,t){let l,{isNetworkError:n}=e,{loading:i}=e,{popupMessageCode:o}=e,{handlePopupClose:r}=e;const s=[["Oh no,","looks like that file's too big."],["That's annoying,","the upload failed due to a connection error."],["Welp,","the server's currently out of rooms."],["Huh,","the server's at its total file count limit."],["Hmm,","the server currently doesn't have enough space."]];return s[99]=["Huh,","that's an unknown error."],a.$$set=u=>{"isNetworkError"in u&&t(0,n=u.isNetworkError),"loading"in u&&t(1,i=u.loading),"popupMessageCode"in u&&t(2,o=u.popupMessageCode),"handlePopupClose"in u&&t(3,r=u.handlePopupClose)},a.$$.update=()=>{a.$$.dirty&36&&t(4,l=s[o])},[n,i,o,r,l,s]}class Je extends Y{constructor(e){super(),Z(this,e,He,We,K,{isNetworkError:0,loading:1,popupMessageCode:2,handlePopupClose:3})}}const ne={time:(a,e)=>{let t=Math.floor(a/3600);a-=t*(60*60);let l=Math.floor(a/60);a-=l*60;let i=[t,l,a];return i.splice(0,i.length-e),i.map(o=>o.toString().padStart(2,"0")).join(":")},shorten:(a,e)=>a.length<e?a:a.slice(0,e-3)+"..."};function Xe(a){let e,t,l,n,i,o;return{c(){e=b("main"),t=le("svg"),l=le("circle"),n=le("circle"),o=le("circle"),this.h()},l(r){e=v(r,"MAIN",{});var s=w(e);t=oe(s,"svg",{viewBox:!0,class:!0});var u=w(t);l=oe(u,"circle",{id:!0,cx:!0,cy:!0,r:!0,class:!0}),w(l).forEach(c),n=oe(u,"circle",{id:!0,style:!0,"stroke-dasharray":!0,"stroke-width":!0,cx:!0,cy:!0,r:!0,transform:!0,class:!0}),w(n).forEach(c),o=oe(u,"circle",{id:!0,"stroke-width":!0,cx:!0,cy:!0,r:!0,class:!0}),w(o).forEach(c),u.forEach(c),s.forEach(c),this.h()},h(){f(l,"id","background"),f(l,"cx","0.5"),f(l,"cy","0.5"),f(l,"r","0.5"),f(l,"class","svelte-f8zowc"),f(n,"id","slice"),_e(n,"transition-duration",a[1]+"s"),f(n,"stroke-dasharray",i=a[0]*(Math.PI/2)+" 3.141592653589793"),f(n,"stroke-width","0.5"),f(n,"cx","0.5"),f(n,"cy","0.5"),f(n,"r","0.25"),f(n,"transform","rotate(-90) translate(-1)"),f(n,"class","svelte-f8zowc"),f(o,"id","outline"),f(o,"stroke-width",$),f(o,"cx","0.5"),f(o,"cy","0.5"),f(o,"r","0.5"),f(o,"class","svelte-f8zowc"),f(t,"viewBox",-$/2+" "+-$/2+" "+(1+$)+" "+(1+$)),f(t,"class","svelte-f8zowc")},m(r,s){k(r,e,s),h(e,t),h(t,l),h(t,n),h(t,o)},p(r,[s]){s&2&&_e(n,"transition-duration",r[1]+"s"),s&1&&i!==(i=r[0]*(Math.PI/2)+" 3.141592653589793")&&f(n,"stroke-dasharray",i)},i:j,o:j,d(r){r&&c(e)}}}const $=.015;function Ye(a,e,t){let{amount:l}=e,{interpolateTime:n}=e;return a.$$set=i=>{"amount"in i&&t(0,l=i.amount),"interpolateTime"in i&&t(1,n=i.interpolateTime)},[l,n]}class Ze extends Y{constructor(e){super(),Z(this,e,Ye,Xe,K,{amount:0,interpolateTime:1})}}var Ke="/app/immutable/assets/download-ddd256eb.svg",Qe="/app/immutable/assets/timer-plus-0c3cdcef.svg",$e="/app/immutable/assets/file-document-outline-8da5362f.svg";function Ee(a){let e,t,l,n,i,o,r,s,u,d,m,_;return{c(){e=b("div"),t=b("button"),l=b("img"),i=U(),o=b("a"),r=b("img"),this.h()},l(g){e=v(g,"DIV",{class:!0});var y=w(e);t=v(y,"BUTTON",{title:!0,class:!0});var E=w(t);l=v(E,"IMG",{src:!0,width:!0,height:!0,alt:!0,class:!0}),E.forEach(c),i=F(y),o=v(y,"A",{href:!0,download:!0,title:!0,class:!0});var V=w(o);r=v(V,"IMG",{src:!0,widt:!0,height:!0,alt:!0,class:!0}),V.forEach(c),y.forEach(c),this.h()},h(){ee(l.src,n=Qe)||f(l,"src",n),f(l,"width","24"),f(l,"height","24"),f(l,"alt","Extend file time limit"),f(l,"class","svelte-baxtgf"),f(t,"title","Extend the time limit"),f(t,"class","svelte-baxtgf"),ee(r.src,s=Ke)||f(r,"src",s),f(r,"widt","24"),f(r,"height","24"),f(r,"alt","Download the file"),f(r,"class","svelte-baxtgf"),f(o,"href",u=`/room/get/${a[0]}/${a[2]}`),f(o,"download",d=a[1].fileName),f(o,"title","Download the file"),f(o,"class","svelte-baxtgf"),f(e,"class","bottom svelte-baxtgf")},m(g,y){k(g,e,y),h(e,t),h(t,l),h(e,i),h(e,o),h(o,r),m||(_=te(t,"click",a[5]),m=!0)},p(g,y){y&5&&u!==(u=`/room/get/${g[0]}/${g[2]}`)&&f(o,"href",u),y&2&&d!==(d=g[1].fileName)&&f(o,"download",d)},d(g){g&&c(e),m=!1,_()}}}function et(a){let e,t,l,n,i,o,r,s,u,d,m=(a[1].ready?a[1].downloading?"Downloading...":ne.time(a[1].timeLeft,2):`${Math.floor(a[1].uploadProgress*100)}% Uploaded`)+"",_,g,y,E,V,x,M,T,z,B=ne.shorten(a[1].fileName,30)+"",q,L,A,fe,S,ue,de;s=new Ze({props:{amount:a[1].ready?a[1].timeLeft/(a[1].quickDownloadDelete?a[3].downloadedFile:a[3].newFile):a[1].uploadProgress,interpolateTime:ae.timings.refreshDelay}});let N=a[1].ready&&Ee(a);return{c(){e=b("main"),t=b("div"),l=b("img"),i=U(),o=b("div"),r=b("div"),W(s.$$.fragment),u=U(),d=b("span"),_=O(m),g=U(),y=b("button"),E=b("img"),T=U(),z=b("p"),q=O(B),L=U(),N&&N.c(),A=U(),fe=b("br"),this.h()},l(p){e=v(p,"MAIN",{class:!0});var D=w(e);t=v(D,"DIV",{class:!0});var Q=w(t);l=v(Q,"IMG",{src:!0,width:!0,height:!0,alt:!0,class:!0}),Q.forEach(c),i=F(D),o=v(D,"DIV",{class:!0});var G=w(o);r=v(G,"DIV",{class:!0});var me=w(r);H(s.$$.fragment,me),me.forEach(c),u=F(G),d=v(G,"SPAN",{class:!0});var he=w(d);_=R(he,m),he.forEach(c),g=F(G),y=v(G,"BUTTON",{title:!0,class:!0});var ge=w(y);E=v(ge,"IMG",{src:!0,width:!0,height:!0,alt:!0,class:!0}),ge.forEach(c),G.forEach(c),T=F(D),z=v(D,"P",{class:!0});var pe=w(z);q=R(pe,B),pe.forEach(c),L=F(D),N&&N.l(D),A=F(D),fe=v(D,"BR",{}),D.forEach(c),this.h()},h(){ee(l.src,n=$e)||f(l,"src",n),f(l,"width","24"),f(l,"height","24"),f(l,"alt","A file icon"),f(l,"class","svelte-baxtgf"),f(t,"class","background svelte-baxtgf"),f(r,"class","piechart svelte-baxtgf"),f(d,"class","svelte-baxtgf"),be(d,"warning",a[1].ready&&!a[1].downloading&&a[1].timeLeft<=15),ee(E.src,V=Pe)||f(E,"src",V),f(E,"width","24"),f(E,"height","24"),f(E,"alt",x=a[1].ready?"Delete the file":"Cancel upload"),f(E,"class","svelte-baxtgf"),f(y,"title",M=a[1].ready?"Delete the file":"Cancel upload"),f(y,"class","svelte-baxtgf"),f(o,"class","top svelte-baxtgf"),f(z,"class","title svelte-baxtgf"),f(e,"class","svelte-baxtgf")},m(p,D){k(p,e,D),h(e,t),h(t,l),h(e,i),h(e,o),h(o,r),J(s,r,null),h(o,u),h(o,d),h(d,_),h(o,g),h(o,y),h(y,E),h(e,T),h(e,z),h(z,q),h(e,L),N&&N.m(e,null),h(e,A),h(e,fe),S=!0,ue||(de=te(y,"click",a[4]),ue=!0)},p(p,[D]){const Q={};D&2&&(Q.amount=p[1].ready?p[1].timeLeft/(p[1].quickDownloadDelete?p[3].downloadedFile:p[3].newFile):p[1].uploadProgress),s.$set(Q),(!S||D&2)&&m!==(m=(p[1].ready?p[1].downloading?"Downloading...":ne.time(p[1].timeLeft,2):`${Math.floor(p[1].uploadProgress*100)}% Uploaded`)+"")&&ce(_,m),D&2&&be(d,"warning",p[1].ready&&!p[1].downloading&&p[1].timeLeft<=15),(!S||D&2&&x!==(x=p[1].ready?"Delete the file":"Cancel upload"))&&f(E,"alt",x),(!S||D&2&&M!==(M=p[1].ready?"Delete the file":"Cancel upload"))&&f(y,"title",M),(!S||D&2)&&B!==(B=ne.shorten(p[1].fileName,30)+"")&&ce(q,B),p[1].ready?N?N.p(p,D):(N=Ee(p),N.c(),N.m(e,A)):N&&(N.d(1),N=null)},i(p){S||(I(s.$$.fragment,p),S=!0)},o(p){P(s.$$.fragment,p),S=!1},d(p){p&&c(e),X(s),N&&N.d(),ue=!1,de()}}}function tt(a,e,t){const l=ie.timings.delete;let{roomName:n}=e,{file:i}=e,{fileID:o}=e,{index:r}=e,{handleDelete:s}=e,{handleExtend:u}=e;const d=_=>{s(o)},m=_=>{u(o)};return a.$$set=_=>{"roomName"in _&&t(0,n=_.roomName),"file"in _&&t(1,i=_.file),"fileID"in _&&t(6,o=_.fileID),"index"in _&&t(2,r=_.index),"handleDelete"in _&&t(7,s=_.handleDelete),"handleExtend"in _&&t(8,u=_.handleExtend)},[n,i,r,l,d,m,o,s,u]}class lt extends Y{constructor(e){super(),Z(this,e,tt,et,K,{roomName:0,file:1,fileID:6,index:2,handleDelete:7,handleExtend:8})}}function Ie(a,e,t){const l=a.slice();return l[4]=e[t],l[6]=t,l}function ot(a){let e=[],t=new Map,l,n,i=a[1].files;const o=r=>r[6];for(let r=0;r<i.length;r+=1){let s=Ie(a,i,r),u=o(s);t.set(u,e[r]=Me(u,s))}return{c(){for(let r=0;r<e.length;r+=1)e[r].c();l=C()},l(r){for(let s=0;s<e.length;s+=1)e[s].l(r);l=C()},m(r,s){for(let u=0;u<e.length;u+=1)e[u].m(r,s);k(r,l,s),n=!0},p(r,s){s&15&&(i=r[1].files,re(),e=Fe(e,s,o,1,r,i,t,l.parentNode,je,Me,l,Ie),se())},i(r){if(!n){for(let s=0;s<i.length;s+=1)I(e[s]);n=!0}},o(r){for(let s=0;s<e.length;s+=1)P(e[s]);n=!1},d(r){for(let s=0;s<e.length;s+=1)e[s].d(r);r&&c(l)}}}function nt(a){let e,t,l,n;return{c(){e=b("p"),t=O("Looks like there aren't any files here yet. "),l=b("br"),n=O(`
            Try uploading one by dropping it here or by clicking the upload button.`),this.h()},l(i){e=v(i,"P",{class:!0});var o=w(e);t=R(o,"Looks like there aren't any files here yet. "),l=v(o,"BR",{}),n=R(o,`
            Try uploading one by dropping it here or by clicking the upload button.`),o.forEach(c),this.h()},h(){f(e,"class","bold svelte-13gsupi")},m(i,o){k(i,e,o),h(e,t),h(e,l),h(e,n)},p:j,i:j,o:j,d(i){i&&c(e)}}}function Ce(a){let e,t;return e=new lt({props:{roomName:a[0],file:a[4],fileID:a[6],index:a[6],handleDelete:a[2],handleExtend:a[3]}}),{c(){W(e.$$.fragment)},l(l){H(e.$$.fragment,l)},m(l,n){J(e,l,n),t=!0},p(l,n){const i={};n&1&&(i.roomName=l[0]),n&2&&(i.file=l[4]),n&2&&(i.fileID=l[6]),n&2&&(i.index=l[6]),n&4&&(i.handleDelete=l[2]),n&8&&(i.handleExtend=l[3]),e.$set(i)},i(l){t||(I(e.$$.fragment,l),t=!0)},o(l){P(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function Me(a,e){let t,l,n,i=e[4]!=null&&Ce(e);return{key:a,first:null,c(){t=C(),i&&i.c(),l=C(),this.h()},l(o){t=C(),i&&i.l(o),l=C(),this.h()},h(){this.first=t},m(o,r){k(o,t,r),i&&i.m(o,r),k(o,l,r),n=!0},p(o,r){e=o,e[4]!=null?i?(i.p(e,r),r&2&&I(i,1)):(i=Ce(e),i.c(),I(i,1),i.m(l.parentNode,l)):i&&(re(),P(i,1,1,()=>{i=null}),se())},i(o){n||(I(i),n=!0)},o(o){P(i),n=!1},d(o){o&&c(t),i&&i.d(o),o&&c(l)}}}function it(a){let e,t,l,n;const i=[nt,ot],o=[];function r(s,u){return s[1].files.length==0?0:1}return t=r(a),l=o[t]=i[t](a),{c(){e=b("main"),l.c()},l(s){e=v(s,"MAIN",{});var u=w(e);l.l(u),u.forEach(c)},m(s,u){k(s,e,u),o[t].m(e,null),n=!0},p(s,[u]){let d=t;t=r(s),t===d?o[t].p(s,u):(re(),P(o[d],1,1,()=>{o[d]=null}),se(),l=o[t],l?l.p(s,u):(l=o[t]=i[t](s),l.c()),I(l,1),l.m(e,null))},i(s){n||(I(l),n=!0)},o(s){P(l),n=!1},d(s){s&&c(e),o[t].d()}}}function at(a,e,t){let{roomName:l}=e,{roomData:n}=e,{handleDelete:i}=e,{handleExtend:o}=e;return a.$$set=r=>{"roomName"in r&&t(0,l=r.roomName),"roomData"in r&&t(1,n=r.roomData),"handleDelete"in r&&t(2,i=r.handleDelete),"handleExtend"in r&&t(3,o=r.handleExtend)},[l,n,i,o]}class rt extends Y{constructor(e){super(),Z(this,e,at,it,K,{roomName:0,roomData:1,handleDelete:2,handleExtend:3})}}function st(a){let e,t;return{c:j,l:j,m(l,n){e||(t=[te(window,"dragover",ve(a[2])),te(window,"drop",ve(a[0]))],e=!0)},p:j,i:j,o:j,d(l){e=!1,Be(t)}}}function ft(a,e,t){let{handleUpload:l}=e;const n=o=>{let r=o.dataTransfer.items;if(r){let s=[];for(let u of r)u.kind=="file"&&s.push(u.getAsFile());s.length!=0&&l(s)}};function i(o){Le.call(this,a,o)}return a.$$set=o=>{"handleUpload"in o&&t(1,l=o.handleUpload)},[n,l,i]}class ut extends Y{constructor(e){super(),Z(this,e,ft,st,K,{handleUpload:1})}}function Te(a){let e,t;return e=new rt({props:{roomName:a[1],roomData:a[0],handleDelete:a[7],handleExtend:a[8]}}),{c(){W(e.$$.fragment)},l(l){H(e.$$.fragment,l)},m(l,n){J(e,l,n),t=!0},p(l,n){const i={};n&2&&(i.roomName=l[1]),n&1&&(i.roomData=l[0]),e.$set(i)},i(l){t||(I(e.$$.fragment,l),t=!0)},o(l){P(e.$$.fragment,l),t=!1},d(l){X(e,l)}}}function ct(a){let e,t,l,n,i,o,r,s;t=new Se({props:{handleUpload:a[5],enableUpload:!a[2]}}),n=new Je({props:{isNetworkError:a[3],loading:a[2],popupMessageCode:a[4],handlePopupClose:a[6]}});let u=!a[2]&&Te(a);return r=new ut({props:{handleUpload:a[5]}}),{c(){e=b("main"),W(t.$$.fragment),l=U(),W(n.$$.fragment),i=U(),u&&u.c(),o=U(),W(r.$$.fragment)},l(d){e=v(d,"MAIN",{});var m=w(e);H(t.$$.fragment,m),l=F(m),H(n.$$.fragment,m),i=F(m),u&&u.l(m),o=F(m),H(r.$$.fragment,m),m.forEach(c)},m(d,m){k(d,e,m),J(t,e,null),h(e,l),J(n,e,null),h(e,i),u&&u.m(e,null),h(e,o),J(r,e,null),s=!0},p(d,[m]){const _={};m&4&&(_.enableUpload=!d[2]),t.$set(_);const g={};m&8&&(g.isNetworkError=d[3]),m&4&&(g.loading=d[2]),m&16&&(g.popupMessageCode=d[4]),n.$set(g),d[2]?u&&(re(),P(u,1,1,()=>{u=null}),se()):u?(u.p(d,m),m&4&&I(u,1)):(u=Te(d),u.c(),I(u,1),u.m(e,o))},i(d){s||(I(t.$$.fragment,d),I(n.$$.fragment,d),I(u),I(r.$$.fragment,d),s=!0)},o(d){P(t.$$.fragment,d),P(n.$$.fragment,d),P(u),P(r.$$.fragment,d),s=!1},d(d){d&&c(e),X(t),X(n),u&&u.d(),X(r)}}}function dt(a,e,t){let n,i,o=!0,r,s=!1;const u=async x=>{if(g==2)return;let M=Date.now();try{let T=await fetch(`/room/get/${i}`);T.ok?t(0,n=await T.json()):(t(0,n=null),t(3,s=!1),await T.text()=="NoRooms"?t(4,g=2):t(4,g=99))}catch{t(0,n=null),t(3,s=!0)}n?o&&(r=setTimeout(T=>{t(2,o=!1)},750-(Date.now()-M))):(t(2,o=!0),r!=null&&clearTimeout(r))},d=x=>{location.href="/"};let m=new Map;const _=x=>{if(o)return;let M=!1;for(let T of x){if(T.size>ae.max.fileSize){M=!0;continue}let z=n.files.length,B=new FormData;B.set("upload",T);let q=new AbortController;fetch(`/room/upload/${i}`,{method:"POST",body:B,signal:q.signal}).then(async L=>{if(m.delete(z),L.ok)return;let A=await L.text();A=="FileTooBig"?t(4,g=0):A=="TooManyFiles"?t(4,g=3):A=="NoSpace"?t(4,g=4):t(4,g=99)}).catch(L=>{m.delete(z),L.name!="AbortSignal"&&t(4,g=1)}),m.set(z,q),t(0,n.files[z]={fileName:T.name,timeLeft:0,ready:!1,uploadProgress:0,size:T.size},n)}M&&t(4,g=0)};let g=-1;const y=x=>{t(4,g=-1)},E=x=>{n.files[x].ready?(fetch(`/room/delete/${i}/${x}`,{method:"POST"}),t(0,n.files[x]=null,n)):m.has(x)&&m.get(x).abort()},V=x=>{let M=n.files[x];fetch(`/room/extend/${i}/${x}`,{method:"POST"}),M.timeLeft=ie.timings.delete.newFile,t(0,n.files[x]=M,n)};return Ae(async x=>{if(t(1,i=location.hash.slice(1)),i==""){d();return}await Promise.all([Oe(),u()]),setInterval(u,ae.timings.refreshDelay*1e3)}),[n,i,o,s,g,_,y,E,V]}class gt extends Y{constructor(e){super(),Z(this,e,dt,ct,K,{})}}export{gt as default};
